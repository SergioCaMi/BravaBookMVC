<!-- Incluye el encabezado de la página desde un archivo parcial -->
<%- include("partials/header") %>

<!-- Incluye mensajes parciales, como notificaciones o alertas -->
<%- include("partials/mensajes") %>

<!-- Hero section moderno -->
<div class="reservation-form-hero position-relative overflow-hidden">
  <div class="hero-background position-absolute top-0 start-0 w-100 h-100"
       style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
  
  <!-- Partículas animadas de fondo -->
  <div class="particles-container position-absolute top-0 start-0 w-100 h-100">
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
  </div>
  
  <div class="hero-content position-relative py-4">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-8">
          <!-- Enlace para volver atrás integrado en el hero -->
          <div class="back-button-container mb-3">
            <a href="#" onclick="window.history.back()" class="back-button btn btn-outline-light rounded-pill px-4 py-2">
              <i class="bi bi-arrow-left me-2"></i>Volver atrás
            </a>
          </div>
          
          <div class="hero-title text-white" style="animation: fadeInLeft 0.8s ease-out;">
            <div class="title-badge mb-3">
              <span class="badge bg-light text-primary px-4 py-2 rounded-pill fs-6 fw-medium">
                <i class="bi bi-pencil-square me-2"></i>Editar Reserva
              </span>
            </div>
            
            <h1 class="display-5 fw-bold mb-3">Modificar Reserva</h1>
            <p class="lead mb-0 text-light">
              Actualiza la información de la reserva de forma sencilla y segura
            </p>
          </div>
        </div>
        
        <div class="col-lg-4 text-center text-lg-end">
          <div class="hero-stats backdrop-blur rounded-4 p-4 shadow-lg border border-light border-opacity-25"
               style="background: rgba(255, 255, 255, 0.1); animation: slideInRight 0.8s ease-out 0.3s both;">
            <div class="stat-item mb-3">
              <div class="stat-icon bg-info bg-gradient rounded-circle d-flex align-items-center justify-content-center mx-auto mb-2"
                   style="width: 50px; height: 50px;">
                <i class="bi bi-calendar-check text-white fs-4"></i>
              </div>
              <h4 class="text-white fw-bold mb-1">Reserva #<%= reservation ? reservation._id.toString().slice(-6) : 'XXXXXX' %></h4>
              <p class="text-light small mb-0">Información actualizable</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Contenedor principal del formulario -->
<div class="reservation-form-container py-5" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
  <div class="container">
    <div class="form-wrapper backdrop-blur rounded-4 shadow-lg border border-light border-opacity-50 overflow-hidden"
         style="background: rgba(255, 255, 255, 0.95);">
      
      <!-- Barra de progreso del formulario -->
      <div class="form-progress-bar position-relative">
        <div class="progress-background bg-light" style="height: 6px;"></div>
        <div class="progress-fill bg-gradient position-absolute top-0 start-0 h-100 transition-all"
             style="width: 0%; background: linear-gradient(90deg, #667eea, #764ba2);"></div>
      </div>
      
      <div class="form-content p-5">
        <!-- Título del formulario -->
        <div class="form-header text-center mb-5">
          <h2 class="fw-bold text-dark mb-3" style="animation: fadeInUp 0.8s ease-out;">
            <i class="bi bi-pencil-square text-primary me-2"></i>
            Editar Reserva
          </h2>
          <p class="text-muted mb-0">Modifica los datos de la reserva según sea necesario</p>
        </div>

        <!-- Verifica si hay datos de reserva disponibles -->
        <% if (reservation) { %>
        <!-- Formulario para editar la reserva -->
        <form id="reservationForm" class="needs-validation" method="POST" action="/admin/reservations/edit/<%= reservation._id %>" novalidate>
          
          <!-- Campo oculto para mantener el ID del apartamento -->
          <input type="hidden" name="apartment" value="<%= reservation.apartment._id || reservation.apartment %>">
          
          <!-- Sección 1: Información del Huésped -->
          <div class="form-section mb-5" data-section="1">
            <div class="section-header d-flex align-items-center mb-4">
              <div class="section-icon bg-primary bg-gradient rounded-circle d-flex align-items-center justify-content-center me-3"
                   style="width: 40px; height: 40px;">
                <i class="bi bi-person text-white"></i>
              </div>
              <div>
                <h4 class="fw-bold text-dark mb-1">Información del Huésped</h4>
                <p class="text-muted small mb-0">Datos personales del cliente</p>
              </div>
            </div>
            
            <div class="row g-4">
              <div class="col-md-6">
                <div class="form-floating">
                  <input type="text" name="guestName" id="guestName" class="form-control form-control-lg"
                         placeholder="Nombre completo del huésped" value="<%= reservation.guestName %>" required>
                  <label for="guestName">
                    <i class="bi bi-person me-2"></i>Nombre completo del huésped
                  </label>
                  <div class="invalid-feedback">Por favor, ingresa el nombre completo del huésped.</div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-floating">
                  <input type="email" name="guestEmail" id="guestEmail" class="form-control form-control-lg"
                         placeholder="Correo electrónico" value="<%= reservation.guestEmail %>" required>
                  <label for="guestEmail">
                    <i class="bi bi-envelope me-2"></i>Correo electrónico
                  </label>
                  <div class="invalid-feedback">Por favor, ingresa un correo electrónico válido.</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Sección 2: Fechas y Apartamento -->
          <div class="form-section mb-5" data-section="2">
            <div class="section-header d-flex align-items-center mb-4">
              <div class="section-icon bg-success bg-gradient rounded-circle d-flex align-items-center justify-content-center me-3"
                   style="width: 40px; height: 40px;">
                <i class="bi bi-calendar-range text-white"></i>
              </div>
              <div>
                <h4 class="fw-bold text-dark mb-1">Fechas y Ubicación</h4>
                <p class="text-muted small mb-0">Período de estancia y apartamento asignado</p>
              </div>
            </div>
            
            <div class="row g-4">
              <div class="col-md-6">
                <div class="form-floating">
                  <input type="text" id="dateRange" name="dateRange" class="form-control form-control-lg" readonly
                         value="<%= reservation ? `${reservation.startDate.toLocaleDateString('es-ES')} - ${reservation.endDate.toLocaleDateString('es-ES')}` : '' %>"
                         placeholder="Rango de fechas" required>
                  <label for="dateRange">
                    <i class="bi bi-calendar-range me-2"></i>Rango de fechas de la reserva
                  </label>
                  <div class="invalid-feedback">Por favor, selecciona un rango válido.</div>
                  <input type="hidden" id="startDateHidden" name="startDate">
                  <input type="hidden" id="endDateHidden" name="endDate">
                  <input type="hidden" name="apartmentId" value="<%= reservation.apartment._id %>">
                </div>
              </div>
              <div class="col-md-6">
                <div class="apartment-info backdrop-blur rounded-3 p-4 border border-light border-opacity-50 h-100 d-flex align-items-center"
                     style="background: rgba(255, 255, 255, 0.7);">
                  <div class="d-flex align-items-center w-100">
                    <div class="apartment-icon bg-primary bg-gradient rounded-circle d-flex align-items-center justify-content-center me-3"
                         style="width: 50px; height: 50px;">
                      <i class="bi bi-house-door text-white fs-4"></i>
                    </div>
                    <div>
                      <h6 class="fw-bold mb-1">Apartamento Asignado</h6>
                      <p class="text-muted small mb-0"><%= reservation.apartment.title || 'Apartamento #' + reservation.apartment._id %></p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>



          <!-- Sección 5: Información del Sistema -->
          <div class="form-section mb-5" data-section="5">
            <div class="section-header d-flex align-items-center mb-4">
              <div class="section-icon bg-secondary bg-gradient rounded-circle d-flex align-items-center justify-content-center me-3"
                   style="width: 40px; height: 40px;">
                <i class="bi bi-clock-history text-white"></i>
              </div>
              <div>
                <h4 class="fw-bold text-dark mb-1">Información del Sistema</h4>
                <p class="text-muted small mb-0">Datos de auditoría (solo lectura)</p>
              </div>
            </div>
            
            <div class="system-info backdrop-blur rounded-3 p-4 border border-light border-opacity-50"
                 style="background: rgba(255, 255, 255, 0.7);">
              <div class="row g-4">
                <div class="col-md-6">
                  <div class="info-item d-flex align-items-center">
                    <div class="info-icon bg-info bg-gradient rounded-circle d-flex align-items-center justify-content-center me-3"
                         style="width: 40px; height: 40px;">
                      <i class="bi bi-calendar-plus text-white"></i>
                    </div>
                    <div>
                      <h6 class="fw-bold mb-1">Fecha de creación</h6>
                      <p class="text-muted small mb-0">
                        <%= reservation.createdAt ? new Date(reservation.createdAt).toLocaleDateString('es-ES') : 'No disponible' %>
                      </p>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="info-item d-flex align-items-center">
                    <div class="info-icon bg-warning bg-gradient rounded-circle d-flex align-items-center justify-content-center me-3"
                         style="width: 40px; height: 40px;">
                      <i class="bi bi-calendar-check text-white"></i>
                    </div>
                    <div>
                      <h6 class="fw-bold mb-1">Última modificación</h6>
                      <p class="text-muted small mb-0">
                        <%= reservation.updatedAt ? new Date(reservation.updatedAt).toLocaleDateString('es-ES') : 'No disponible' %>
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Botones de acción -->
          <div class="form-actions d-flex gap-3 justify-content-center mt-5 pt-4 border-top">
            <button type="submit" class="btn btn-primary btn-lg rounded-pill px-5 hover-lift">
              <i class="bi bi-save me-2"></i>Guardar cambios
            </button>
            <a href="/admin/reservations" class="btn btn-outline-secondary btn-lg rounded-pill px-5 hover-lift">
              <i class="bi bi-arrow-left me-2"></i>Cancelar
            </a>
            <button type="button" class="btn btn-outline-danger btn-lg rounded-pill px-5 hover-lift" 
                    data-bs-toggle="modal" data-bs-target="#deleteReservationModal">
              <i class="bi bi-trash me-2"></i>Eliminar
            </button>
          </div>
        </form>

        <% } else { %>
        <div class="text-center py-5">
          <div class="empty-state">
            <i class="bi bi-calendar-x text-muted" style="font-size: 4rem;"></i>
            <h4 class="text-muted mt-3">No hay reservas disponibles</h4>
            <p class="text-muted">La reserva solicitada no se encontró en el sistema.</p>
          </div>
        </div>
        <% } %>
      </div>
    </div>
  </div>
</div>

<!-- MODAL MOVIDO FUERA DE TODOS LOS CONTENEDORES PARA EVITAR PROBLEMAS DE Z-INDEX -->
<% if (reservation) { %>
<!-- Modal para confirmar eliminación de reserva -->
<div class="modal fade" id="deleteReservationModal" tabindex="-1" aria-labelledby="deleteReservationLabel" aria-hidden="true" style="z-index: 1055 !important;">
  <div class="modal-dialog modal-dialog-centered" style="z-index: 1060 !important;">
    <div class="modal-content border-0 shadow-lg" style="z-index: 1065 !important;">
      <div class="modal-header bg-danger text-white border-0">
        <h5 class="modal-title fw-bold" id="deleteReservationLabel">
          <i class="bi bi-exclamation-triangle me-2"></i>
          Confirmar eliminación de reserva
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body p-4">
        <div class="text-center mb-4">
          <div class="warning-icon bg-danger bg-gradient rounded-circle d-flex align-items-center justify-content-center mx-auto mb-3"
               style="width: 60px; height: 60px;">
            <i class="bi bi-exclamation-triangle text-white fs-3"></i>
          </div>
          <h6 class="fw-bold">¿Estás seguro de que quieres eliminar esta reserva?</h6>
        </div>
        <div class="alert alert-warning border-0">
          <i class="bi bi-info-circle me-2"></i>
          <strong>Advertencia:</strong> Esta acción no se puede deshacer y eliminará permanentemente todos los datos de la reserva.
        </div>
      </div>
      <div class="modal-footer border-0 justify-content-center">
        <button type="button" class="btn btn-secondary rounded-pill px-4" data-bs-dismiss="modal">
          <i class="bi bi-x me-1"></i>Cancelar
        </button>
        <a href="/admin/reservations/delete/<%= reservation._id %>" class="btn btn-danger rounded-pill px-4">
          <i class="bi bi-trash me-1"></i>Sí, eliminar
        </a>
      </div>
    </div>
  </div>
</div>
<% } %>

<!-- Estilos CSS personalizados -->
<style>
/* ========== SOLUCIÓN ESPECÍFICA PARA MODALES EN EDIT RESERVATION ========== */
/* Asegurar z-index correcto para modales - SOLUCIÓN AGRESIVA */
.modal {
  z-index: 1055 !important;
}

.modal-backdrop {
  z-index: 1050 !important;
}

.modal.show {
  z-index: 1055 !important;
}

.modal-dialog {
  z-index: 1060 !important;
}

.modal-content {
  z-index: 1065 !important;
  position: relative !important;
  border-radius: 1rem !important;
  overflow: hidden !important;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2) !important;
  border: none !important;
}

/* SOLUCIÓN ESPECÍFICA PARA EDITRESERVATION - OVERRIDE AGRESIVO */
#deleteReservationModal {
  z-index: 1055 !important;
  position: fixed !important;
}

#deleteReservationModal .modal-dialog {
  z-index: 1060 !important;
  position: relative !important;
}

#deleteReservationModal .modal-content {
  z-index: 1065 !important;
  position: relative !important;
}

/* Asegurar que el hero section no interfiera */
.reservation-form-hero,
.hero-background {
  z-index: 1 !important;
}

/* Asegurar que las partículas no interfieran */
.particles-container {
  z-index: 2 !important;
}

/* Asegurar que el contenedor del formulario no interfiera */
.reservation-form-container,
.form-wrapper {
  z-index: auto !important;
  position: relative;
}

/* Override para backdrop-filter que puede causar stacking context */
.backdrop-blur,
[style*="backdrop-filter"] {
  z-index: auto !important;
}

/* Asegurar que cualquier elemento con backdrop-filter no interfiera */
*[style*="backdrop-filter"] {
  z-index: auto !important;
}

/* Forzar z-index en elementos que pueden estar interfiriendo */
.hero-stats,
.form-header,
.form-progress-bar {
  z-index: auto !important;
}
/* ========== FIN SOLUCIÓN ESPECÍFICA PARA MODALES ========== */

/* Efectos de transición globales */
.transition-all {
  transition: all 0.3s ease !important;
}

.hover-lift:hover {
  transform: translateY(-3px) !important;
  box-shadow: 0 10px 25px rgba(0,0,0,0.15) !important;
}

/* Hero section */
.reservation-form-hero {
  min-height: 40vh;
  display: flex;
  align-items: center;
  position: relative;
}

.hero-background {
  background-attachment: fixed;
}

/* Partículas animadas */
.particles-container {
  pointer-events: none;
}

.particle {
  position: absolute;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 50%;
  animation: float 6s ease-in-out infinite;
}

.particle:nth-child(1) {
  width: 20px;
  height: 20px;
  top: 20%;
  left: 20%;
  animation-delay: 0s;
}

.particle:nth-child(2) {
  width: 15px;
  height: 15px;
  top: 60%;
  left: 80%;
  animation-delay: 2s;
}

.particle:nth-child(3) {
  width: 25px;
  height: 25px;
  top: 80%;
  left: 10%;
  animation-delay: 4s;
}

.particle:nth-child(4) {
  width: 12px;
  height: 12px;
  top: 30%;
  left: 70%;
  animation-delay: 1s;
}

.particle:nth-child(5) {
  width: 18px;
  height: 18px;
  top: 70%;
  left: 50%;
  animation-delay: 3s;
}

@keyframes float {
  0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.7; }
  50% { transform: translateY(-20px) rotate(180deg); opacity: 1; }
}

/* Botón de volver atrás */
.back-button {
  background: rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.3);
  transition: all 0.3s ease;
}

.back-button:hover {
  background: rgba(255, 255, 255, 0.3);
  transform: translateX(-5px);
  color: white !important;
}

/* Glassmorphism effects */
.backdrop-blur {
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
}

/* Barra de progreso del formulario */
.form-progress-bar {
  height: 6px;
  background: #f8f9fa;
}

.progress-fill {
  transition: width 0.5s ease;
}

/* Secciones del formulario */
.form-section {
  animation: fadeInUp 0.6s ease-out;
  opacity: 0;
  animation-fill-mode: forwards;
}

.form-section:nth-child(1) { animation-delay: 0.1s; }
.form-section:nth-child(2) { animation-delay: 0.2s; }
.form-section:nth-child(3) { animation-delay: 0.3s; }
.form-section:nth-child(4) { animation-delay: 0.4s; }
.form-section:nth-child(5) { animation-delay: 0.5s; }

/* Iconos de sección */
.section-icon {
  transition: all 0.3s ease;
}

.form-section:hover .section-icon {
  transform: scale(1.1);
}

/* Campos de formulario mejorados */
.form-floating > .form-control:focus ~ label,
.form-floating > .form-control:not(:placeholder-shown) ~ label,
.form-floating > .form-select:focus ~ label,
.form-floating > .form-select:not([value=""]) ~ label {
  color: #667eea;
}

.form-floating > .form-control:focus,
.form-floating > .form-select:focus {
  border-color: #667eea;
  box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}

/* Contenedores especiales */
.apartment-info,
.status-container,
.system-info {
  transition: all 0.3s ease;
}

.apartment-info:hover,
.status-container:hover,
.system-info:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.1);
}

/* Elementos de información */
.info-item {
  transition: all 0.3s ease;
}

.info-item:hover {
  transform: translateX(5px);
}

/* Botones mejorados */
.btn {
  transition: all 0.3s ease;
  border-width: 2px;
}

.btn:hover {
  transform: translateY(-2px);
}

.btn-primary {
  background: linear-gradient(135deg, #667eea, #764ba2);
  border: none;
}

.btn-primary:hover {
  background: linear-gradient(135deg, #5a6fd8, #6a4190);
}

/* Modal mejorado */
.modal-content {
  border-radius: 1rem;
  overflow: hidden;
}

.warning-icon {
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

/* Animaciones de entrada */
@keyframes fadeInLeft {
  from {
    opacity: 0;
    transform: translateX(-30px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(30px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Responsive */
@media (max-width: 768px) {
  .reservation-form-hero {
    min-height: 60vh;
  }
  
  .hero-title h1 {
    font-size: 2rem !important;
  }
  
  .form-content {
    padding: 2rem !important;
  }
  
  .form-actions {
    flex-direction: column;
  }
  
  .form-actions .btn {
    width: 100%;
  }
}

/* Efectos adicionales */
.form-wrapper {
  animation: slideInUp 0.8s ease-out;
}

.section-header {
  animation: fadeInUp 0.6s ease-out;
}

@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Estados de validación mejorados */
.was-validated .form-control:valid,
.was-validated .form-select:valid {
  border-color: #28a745;
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%2328a745' d='m2.3 6.73.94-.94 1.44 1.44L7.4 4.5l.94.94L4.6 9.18z'/%3e%3c/svg%3e");
}

.was-validated .form-control:invalid,
.was-validated .form-select:invalid {
  border-color: #dc3545;
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='m5.8 4.6 1.4 1.4M7.2 4.6l-1.4 1.4'/%3e%3c/svg%3e");
}

/* Switch personalizado */
.form-check-input:checked {
  background-color: #667eea;
  border-color: #667eea;
}

/* Contador de caracteres */
.form-text {
  font-size: 0.875rem;
  color: #6c757d;
}

/* Estado vacío */
.empty-state {
  animation: fadeInUp 0.8s ease-out;
}
</style>

<!-- Scripts para funcionalidades -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Contador de caracteres para notas
  const notesField = document.getElementById('notes');
  const notesCharCount = document.getElementById('notesCharCount');
  
  if (notesField && notesCharCount) {
    // Inicializar contador
    notesCharCount.textContent = notesField.value.length;
    
    notesField.addEventListener('input', function() {
      notesCharCount.textContent = this.value.length;
      if (this.value.length > 900) {
        notesCharCount.style.color = '#dc3545';
      } else if (this.value.length > 750) {
        notesCharCount.style.color = '#ffc107';
      } else {
        notesCharCount.style.color = '#6c757d';
      }
    });
  }
  
  // Actualizar barra de progreso
  function updateProgressBar() {
    const sections = document.querySelectorAll('.form-section');
    const totalSections = sections.length;
    let completedSections = 0;
    
    sections.forEach(section => {
      const requiredFields = section.querySelectorAll('[required]');
      let sectionComplete = true;
      
      requiredFields.forEach(field => {
        if (!field.value.trim()) {
          sectionComplete = false;
        }
      });
      
      if (sectionComplete && requiredFields.length > 0) {
        completedSections++;
      }
    });
    
    const progress = (completedSections / totalSections) * 100;
    const progressBar = document.querySelector('.progress-fill');
    if (progressBar) {
      progressBar.style.width = progress + '%';
    }
  }
  
  // Actualizar progreso en tiempo real
  document.addEventListener('input', updateProgressBar);
  document.addEventListener('change', updateProgressBar);
  
  // Validación del formulario
  const form = document.getElementById('reservationForm');
  if (form) {
    form.addEventListener('submit', function(e) {
      if (!form.checkValidity()) {
        e.preventDefault();
        e.stopPropagation();
      }
      form.classList.add('was-validated');
    });
  }
  
  // Inicializar progreso
  updateProgressBar();
  
  // Efecto hover en las secciones
  const sections = document.querySelectorAll('.form-section');
  sections.forEach(section => {
    section.addEventListener('mouseenter', function() {
      this.style.transform = 'translateY(-2px)';
    });
    
    section.addEventListener('mouseleave', function() {
      this.style.transform = 'translateY(0)';
    });
  });
  
  // SOLUCIÓN ESPECÍFICA PARA EL MODAL DE ELIMINACIÓN
  const deleteModal = document.getElementById('deleteReservationModal');
  if (deleteModal) {
    // Forzar z-index al mostrar el modal
    deleteModal.addEventListener('show.bs.modal', function(e) {
      console.log('Mostrando modal de eliminación...');
      
      // Aplicar z-index directamente
      this.style.zIndex = '1055';
      this.style.position = 'fixed';
      
      // Asegurar que el backdrop tenga el z-index correcto
      setTimeout(() => {
        const backdrop = document.querySelector('.modal-backdrop');
        if (backdrop) {
          backdrop.style.zIndex = '1050';
          console.log('Backdrop z-index aplicado');
        }
      }, 50);
    });
    
    // Después de mostrar el modal
    deleteModal.addEventListener('shown.bs.modal', function(e) {
      console.log('Modal mostrado completamente');
      
      // Aplicar z-index a elementos internos
      const modalDialog = this.querySelector('.modal-dialog');
      if (modalDialog) {
        modalDialog.style.zIndex = '1060';
      }
      
      const modalContent = this.querySelector('.modal-content');
      if (modalContent) {
        modalContent.style.zIndex = '1065';
      }
      
      // Verificar que esté por encima
      const computedStyle = window.getComputedStyle(this);
      console.log('Z-index final del modal:', computedStyle.zIndex);
    });
    
    // Limpiar backdrops al cerrar
    deleteModal.addEventListener('hidden.bs.modal', function(e) {
      const backdrops = document.querySelectorAll('.modal-backdrop');
      backdrops.forEach(backdrop => {
        if (!document.querySelector('.modal.show')) {
          backdrop.remove();
        }
      });
    });
    
    // Forzar inicialización del modal con configuración específica
    new bootstrap.Modal(deleteModal, {
      backdrop: true,
      keyboard: true,
      focus: true
    });
    
    console.log('Modal de eliminación configurado correctamente');
  }
});
</script>

<!-- Script para manejar los datos de la reserva -->
<% if (reservation) { %>
<script>
  const reservationData = {
    startDate: "<%= reservation.startDate.toISOString().split('T')[0] %>",
    endDate: "<%= reservation.endDate.toISOString().split('T')[0] %>",
  };
</script>
<% } %>

<!-- Script para funcionalidades adicionales -->
<script src="/js/editReservation.js"></script>

<!-- Script de testing para hero visibility -->
<script src="/js/heroVisibilityTest.js"></script>

<!-- Script específico para forzar visibilidad del hero en editReservation -->
<script>
// Ejecutar funciones globales de hero visibility después de que la página esté cargada
document.addEventListener('DOMContentLoaded', function() {
  console.log('=== INICIANDO FIX ESPECÍFICO PARA HERO EN EDITRESERVATION ===');
  
  // Delay para asegurar que todos los recursos estén cargados
  setTimeout(() => {
    // Ejecutar función global si está disponible
    if (window.forceHeroVisibility) {
      console.log('Ejecutando función global de visibilidad hero...');
      window.forceHeroVisibility();
    }
    
    if (window.detectAndFixHiddenHeroes) {
      console.log('Ejecutando detección de heroes ocultos...');
      window.detectAndFixHiddenHeroes();
    }
    
    // Fix específico para editReservation hero
    const heroContainer = document.querySelector('.reservation-form-hero');
    const heroBackground = document.querySelector('.hero-background');
    const heroContent = document.querySelector('.hero-content');
    
    if (heroContainer) {
      console.log('Aplicando fix específico al hero container...');
      heroContainer.style.cssText += `
        visibility: visible !important;
        opacity: 1 !important;
        display: flex !important;
        position: relative !important;
        min-height: 40vh !important;
        align-items: center !important;
        overflow: hidden !important;
      `;
    }
    
    if (heroBackground) {
      console.log('Aplicando fix específico al hero background...');
      heroBackground.style.cssText += `
        visibility: visible !important;
        opacity: 1 !important;
        display: block !important;
        position: absolute !important;
        top: 0 !important;
        left: 0 !important;
        width: 100% !important;
        height: 100% !important;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        z-index: 1 !important;
      `;
    }
    
    if (heroContent) {
      console.log('Aplicando fix específico al hero content...');
      heroContent.style.cssText += `
        visibility: visible !important;
        opacity: 1 !important;
        display: block !important;
        position: relative !important;
        z-index: 10 !important;
        padding-top: 1.5rem !important;
        padding-bottom: 1.5rem !important;
      `;
    }
    
    // Fix para partículas
    const particles = document.querySelectorAll('.particle');
    particles.forEach(particle => {
      particle.style.cssText += `
        visibility: visible !important;
        opacity: 0.7 !important;
        display: block !important;
      `;
    });
    
    // Fix para elementos específicos del hero
    const heroStats = document.querySelector('.hero-stats');
    if (heroStats) {
      heroStats.style.cssText += `
        visibility: visible !important;
        opacity: 1 !important;
        display: block !important;
        position: relative !important;
        z-index: 10 !important;
      `;
    }
    
    const titleBadge = document.querySelector('.title-badge');
    if (titleBadge) {
      titleBadge.style.cssText += `
        visibility: visible !important;
        opacity: 1 !important;
        display: block !important;
      `;
    }
    
    console.log('=== FIX ESPECÍFICO PARA HERO EN EDITRESERVATION COMPLETADO ===');
  }, 1200); // Delay mayor para asegurar que todo esté listo
});
</script>

<!-- Incluye el pie de página desde un archivo parcial -->
<%- include("partials/footer") %>
