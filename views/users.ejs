<%- include("partials/header", { title }) %>

<a href="#" onclick="window.history.back()" class="row justify-content-start">
  <img src="/img/back.png" alt="Volver atrás" style="max-width: 70px; height: auto;" class="m-3">
</a>

<div class="container my-5">
  <div class="bg-white p-4 shadow rounded-4">
    <h2 class="text-center text-primary fw-bold mb-4">Usuarios Registrados</h2>

    <% if (users && users.length > 0) { 
         const chunkSize = 20;
         const totalPages = Math.ceil(users.length / chunkSize);
    %>

    <!-- Carrusel de usuarios -->
    <div id="usersCarousel" class="carousel slide" data-bs-interval="false">
      <div class="carousel-inner">

        <% for (let i = 0; i < totalPages; i++) {
             const currentChunk = users.slice(i * chunkSize, (i + 1) * chunkSize);
        %>
        <div class="carousel-item <%= i === 0 ? 'active' : '' %>">
          <div class="table-responsive">
            <table class="table table-hover align-middle text-center mb-0">
              <thead class="table-dark">
                <tr>
                  <th>#</th>
                  <th>Avatar</th>
                  <th>Nombre</th>
                  <th>Email</th>
                  <th>Rol</th>
                  <th>Biografía</th>
                </tr>
              </thead>
              <tbody>
                <% currentChunk.forEach((user, index) => { %>
                  <tr>
                    <td><%= (i * chunkSize) + index + 1 %></td>
                    <td>
                      <img src="/uploads/<%= user.avatar %>" alt="Avatar" class="rounded-circle shadow-sm"
                        style="width: 50px; height: 50px; object-fit: cover;">
                    </td>
                    <td><strong><%= user.name %></strong></td>
                    <td><%= user.email %></td>
                    <td>
                      <span class="badge <%= user.role === 'admin' ? 'bg-primary' : 'bg-secondary' %>">
                        <%= user.role %>
                      </span>
                    </td>
                    <td><%= user.bio || '-' %></td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        </div>
        <% } %>
      </div>
    </div>

    <!-- Controles de navegación -->
    <div class="d-flex justify-content-center gap-3 mt-4">
      <button class="btn btn-outline-primary" type="button" data-bs-target="#usersCarousel" data-bs-slide="prev">
        <i class="bi bi-chevron-left me-1"></i> Anterior
      </button>
      <button class="btn btn-outline-primary" type="button" data-bs-target="#usersCarousel" data-bs-slide="next">
        Siguiente <i class="bi bi-chevron-right ms-1"></i>
      </button>
    </div>

    <!-- Indicadores opcionales -->
    <div class="d-flex justify-content-center mt-3">
      <div class="carousel-indicators position-static">
        <% for (let i = 0; i < totalPages; i++) { %>
          <button type="button" data-bs-target="#usersCarousel" data-bs-slide-to="<%= i %>"
            class="<%= i === 0 ? 'active' : '' %>" aria-label="Página <%= i + 1 %>"></button>
        <% } %>
      </div>
    </div>

    <% } else { %>
      <div class="alert alert-info text-center">No hay usuarios registrados.</div>
    <% } %>
  </div>
</div>

<%- include("partials/footer") %>
